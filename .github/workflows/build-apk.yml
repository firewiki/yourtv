# 工作流的名称，会显示在 GitHub Actions 页面上
name: Build YourTV APK

# 工作流的触发条件
on:
  # 1. 允许手动触发 (在 Actions 页面会有一个 'Run workflow' 按钮)
  workflow_dispatch:

  # 2. (可选) 当有代码推送到 main 分支时自动触发
  push:
    branches: [ "main" ]

# 定义工作流中的任务 (jobs)
jobs:
  # 我们只有一个任务，命名为 "build"
  build:
    # 指定运行此任务的虚拟机环境，'ubuntu-latest' 是最常用的选择
    runs-on: ubuntu-latest

    # 定义任务中的具体步骤 (steps)
    steps:
      # 第 1 步：检出代码
      # 使用官方的 'checkout' action 来获取仓库的最新代码
      - name: Checkout repository
        uses: actions/checkout@v4

      # 第 2 步：设置 JDK (Java Development Kit)
      # YourTV 项目需要 Java 17 来编译
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin' # 一个稳定、可靠的 Java 发行版
          cache: 'gradle' # 缓存 Gradle 依赖，可以极大加快后续编译速度

      # 第 3 步：授予 Gradle Wrapper 执行权限
      # 这是一个常见的步骤，确保 gradlew 脚本可以被执行
      - name: Grant execute permission to gradlew
        run: chmod +x gradlew

      # 第 4 步：使用 Gradle 进行编译
      # 执行 './gradlew assembleRelease' 命令来构建 Release 版本的 APK
      - name: Build with Gradle
        run: ./gradlew assembleRelease

      # 第 5 步：上传编译好的 APK 文件
      # 使用官方的 'upload-artifact' action 将 APK 保存为构建产物
      - name: Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          # 构建产物的名称，您下载时会看到这个名字
          name: YourTV-APK
          # 要上传的文件的路径。安卓项目编译的 release APK 通常在这个位置
          path: app/build/outputs/apk/release/app-release.apk

